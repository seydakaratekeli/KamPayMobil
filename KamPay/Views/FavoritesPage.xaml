<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:KamPay.ViewModels"
             xmlns:models="clr-namespace:KamPay.Models"
             x:Class="KamPay.Views.FavoritesPage"
             Title="Favoriler"
             Shell.BackgroundColor="{StaticResource Primary}">

    <RefreshView IsRefreshing="{Binding IsRefreshing}"
                 Command="{Binding RefreshFavoritesCommand}">

        <CollectionView ItemsSource="{Binding FavoriteItems}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <VerticalStackLayout Padding="40" VerticalOptions="Center" HorizontalOptions="Center">
                    <Label Text="❤️" FontSize="60" HorizontalTextAlignment="Center" />
                    <Label Text="{Binding EmptyMessage}" FontSize="16" TextColor="{StaticResource Gray600}" HorizontalTextAlignment="Center" Margin="0,10,0,0" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Favorite">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Çıkar"
                                           BackgroundColor="{StaticResource Danger}"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FavoritesViewModel}}, Path=RemoveFavoriteCommand}"
                                           CommandParameter="{Binding .}" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <Frame Margin="15,10" Padding="0" CornerRadius="15" BorderColor="#E0E0E0" BackgroundColor="White">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:FavoritesViewModel}}, Path=ProductTappedCommand}"
                                                      CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>

                            <Grid ColumnDefinitions="120,*">
                                <Image Grid.Column="0"
                                       Source="{Binding ProductThumbnail}"
                                       Aspect="AspectFill"
                                       HeightRequest="120">
                                    <Image.Clip>
                                        <RoundRectangleGeometry Rect="0,0,120,120" CornerRadius="15,0,0,15" />
                                    </Image.Clip>
                                </Image>

                                <VerticalStackLayout Grid.Column="1" Padding="15" Spacing="8">
                                    <Label Text="{Binding ProductTitle}"
                                           FontAttributes="Bold"
                                           FontSize="16"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="2" />

                                    <Label Text="{Binding PriceText}"
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           TextColor="{StaticResource Primary}" />

                                    <Label Text="{Binding TimeAgoText}"
                                           FontSize="11"
                                           TextColor="{StaticResource Gray600}" />
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </RefreshView>

</ContentPage>