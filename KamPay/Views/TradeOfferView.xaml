<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:vm="clr-namespace:KamPay.ViewModels"
               xmlns:models="clr-namespace:KamPay.Models"
               x:Class="KamPay.Views.TradeOfferView"
               x:DataType="vm:TradeOfferViewModel"
               x:Name="thisPopup">

    <Frame Margin="15" Padding="20" CornerRadius="15" VerticalOptions="Center">
        <VerticalStackLayout Spacing="15" WidthRequest="300">
            <Label Text="Takas için bir ürününü seç" FontSize="20" FontAttributes="Bold"/>

            <CollectionView ItemsSource="{Binding MyProducts}" 
                            SelectionMode="Single"
                            SelectedItem="{Binding SelectedProduct, Mode=TwoWay}"
                            HeightRequest="250">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Product">
                        <Grid Padding="10" Margin="0,5">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="Normal" />
                                    <VisualState Name="Selected">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="{StaticResource Primary}" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>

                            <HorizontalStackLayout Spacing="10">
                                <Image Source="{Binding ThumbnailUrl}" Aspect="AspectFill" WidthRequest="60" HeightRequest="60" />
                                <Label Text="{Binding Title}" VerticalOptions="Center">
                                    <Label.Style>
                                        <Style TargetType="Label">
                                            <Setter Property="TextColor" Value="Black" />
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding IsSelected, Source={RelativeSource AncestorType={x:Type Grid}}}" Value="True">
                                                    <Setter Property="TextColor" Value="White" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>
                            </HorizontalStackLayout>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Editor Placeholder="Teklif notu (isteğe bağlı)..." Text="{Binding OfferMessage}" HeightRequest="80"/>

            <Button Text="Teklifi Gönder" 
                    Command="{Binding SubmitOfferCommand}" 
                    CommandParameter="{Binding Source={x:Reference thisPopup}}" 
                    BackgroundColor="{StaticResource Primary}"/>
            <Button Text="İptal" 
                    Command="{Binding CancelCommand}" 
                    CommandParameter="{Binding Source={x:Reference thisPopup}}" 
                    BackgroundColor="{StaticResource Gray500}"/>
        </VerticalStackLayout>
    </Frame>
</toolkit:Popup>